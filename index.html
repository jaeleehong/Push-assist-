<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‰´ë§ê³ ) ì‹œì¦Œë ˆì´ìŠ¤ í‘¸ì‹œ ë©”ì‹œì§€ ìë™ ìƒì„± ë„êµ¬</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 1.1rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-right: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .result-section {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .result-table th,
        .result-table td {
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }

        .result-table th,
        .result-table td {
            width: 140px;
            text-align: center;
            vertical-align: middle;
        }

        .result-table th:first-child,
        .result-table td:first-child {
            width: 120px;
        }

        .result-table th:nth-child(2),
        .result-table td:nth-child(2) {
            width: 100px;
        }

        .result-table th:nth-child(3),
        .result-table td:nth-child(3) {
            width: 120px;
        }

        .result-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 500;
            text-align: center;
        }

        .result-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .export-section {
            margin-top: 30px;
            text-align: center;
        }

        .copy-btn {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            margin-left: 10px;
        }

        .download-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            margin-left: 10px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #424242;
            line-height: 1.6;
        }

        .template-section {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .template-section h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .template-example {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }

        .season-name-input {
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .result-table {
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ´ ë‰´ë§ê³ _ ì‹œì¦Œë ˆì´ìŠ¤ í‘¸ì‹œ ë©”ì‹œì§€ ìë™ ìƒì„± ë„êµ¬</h1>
            <p>ê¸°íšì„œë¥¼ ë³µì‚¬ ë¶™ì—¬ë„£ê¸°í•˜ë©´ í‘¸ì‹œ ë©”ì‹œì§€ ë°œì†¡ì¼ê³¼ ë‚´ìš©ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤</p>
        </header>

        <main class="main-content">
            <div class="info-box">
                <h3><i class="fas fa-info-circle"></i> ì‚¬ìš© ë°©ë²•</h3>
                <p>1. ì£¼ì œì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ë”ìœ„ì‚¬ëƒ¥, ë¡œë§¨í‹±)<br>
                   2. ê¸°íšì„œ í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”<br>
                   3. "í‘¸ì‹œ ë©”ì‹œì§€ ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”<br>
                   4. ìë™ìœ¼ë¡œ ëª¨ë“  ì»¬ëŸ¼ì´ ìƒì„±ë©ë‹ˆë‹¤</p>
            </div>

            <div class="template-section">
                <h3><i class="fas fa-file-alt"></i> ê¸°íšì„œ ì…ë ¥ ì˜ˆì‹œ</h3>
                <div class="template-example">25/5ì›” ì ê²€	race_heathunting	155	5/29 18:00	6/2 10:00	5/29 18:00	6/2 0:00	5/31		6/2 17:00	6/4 10:00
							6/1			
		156	6/5 18:00	6/9 10:00	6/5 18:00	6/9 0:00	6/7		6/9 17:00	6/11 10:00
							6/8			
		157	6/12 18:00	6/16 10:00	6/12 18:00	6/16 0:00	6/14		6/16 17:00	6/18 10:00
							6/15			
		158	6/19 18:00	6/23 10:00	6/19 18:00	6/23 0:00	6/21		6/23 17:00	6/25 10:00
							6/22			
		159	6/26 18:00	6/30 10:00	6/26 18:00	6/30 0:00	6/28		6/30 17:00	7/2 10:00
							6/29			
		160	7/3 18:00	7/7 10:00	7/3 18:00	7/7 0:00	7/5		7/7 17:00	7/9 10:00
							7/6			
		161	7/10 18:00	7/14 10:00	7/10 18:00	7/14 0:00	7/12		7/14 17:00	7/16 10:00
							7/13			
		162	7/17 18:00	7/21 10:00	7/17 18:00	7/21 0:00	7/19		7/21 17:00	7/23 10:00
							7/20			
		163	7/24 18:00	7/28 10:00	7/24 18:00	7/28 0:00	7/26		7/28 17:00	7/30 10:00
							7/27			
		164	7/31 18:00	8/4 10:00	7/31 18:00	8/4 0:00	8/2		8/4 17:00	8/6 10:00
							8/3			
		165	8/7 18:00	8/11 10:00	8/7 18:00	8/11 0:00	8/9		8/11 17:00	8/13 10:00
							8/10			
		166	8/14 18:00	8/18 10:00	8/14 18:00	8/18 0:00	8/16		8/18 17:00	8/20 10:00
							8/17			
		167	8/21 18:00	8/23 10:00	8/21 18:00	8/23 0:00	8/22 20:00	8/23 0:00	8/24 17:00	8/25 10:00</div>
            </div>

            <div class="input-section">
                <h2><i class="fas fa-cog"></i> ì…ë ¥ ì„¤ì •</h2>
                


                <div class="form-group">
                    <label for="theme-keyword"><i class="fas fa-trophy"></i> ì£¼ì œì–´</label>
                    <input type="text" id="theme-keyword" placeholder="ì˜ˆ: ë”ìœ„ì‚¬ëƒ¥, ë¡œë§¨í‹±, ê²¨ìš¸ì‚¬ëƒ¥ ë“±" required>
                </div>

                <div class="form-group">
                    <label for="planning-text"><i class="fas fa-tasks"></i> ê¸°íšì„œ í…ìŠ¤íŠ¸ (ë³µì‚¬ ë¶™ì—¬ë„£ê¸°)</label>
                    <textarea id="planning-text" rows="15" placeholder="ê¸°íšì„œ í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•´ì„œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”..." required></textarea>
                </div>

                <div class="form-group">
                    <button id="generate-btn" class="btn">
                        <i class="fas fa-magic"></i> í‘¸ì‹œ ë©”ì‹œì§€ ìƒì„±
                    </button>
                    <button id="clear-btn" class="btn btn-secondary">
                        <i class="fas fa-trash"></i> ì´ˆê¸°í™”
                    </button>
                </div>
            </div>

            <div id="result-section" class="result-section" style="display: none;">
                <h2><i class="fas fa-table"></i> ìƒì„±ëœ í‘¸ì‹œ ë©”ì‹œì§€</h2>
                <div id="result-table-container"></div>
                
                <div class="export-section">
                    <button id="copy-btn" class="btn copy-btn">
                        <i class="fas fa-copy"></i> ìŠ¤í”„ë ˆë“œì‹œíŠ¸ í˜•ì‹ìœ¼ë¡œ ë³µì‚¬
                    </button>
                    <button id="download-btn" class="btn download-btn">
                        <i class="fas fa-download"></i> CSV ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
// ì‹œì¦Œë ˆì´ìŠ¤ í‘¸ì‹œ ë©”ì‹œì§€ ìë™ ìƒì„± ë„êµ¬
class SeasonRacePushGenerator {
    constructor() {
        this.initializeElements();
        this.bindEvents();
    }

    initializeElements() {
        this.themeKeywordInput = document.getElementById('theme-keyword');
        this.planningTextInput = document.getElementById('planning-text');
        this.generateBtn = document.getElementById('generate-btn');
        this.clearBtn = document.getElementById('clear-btn');
        this.copyBtn = document.getElementById('copy-btn');
        this.downloadBtn = document.getElementById('download-btn');
        this.resultSection = document.getElementById('result-section');
        this.resultTableContainer = document.getElementById('result-table-container');
    }

    bindEvents() {
        this.generateBtn.addEventListener('click', () => this.generatePushMessages());
        this.clearBtn.addEventListener('click', () => this.clearForm());
        this.copyBtn.addEventListener('click', () => this.copyToClipboard());
        this.downloadBtn.addEventListener('click', () => this.downloadCSV());
    }

    generatePushMessages() {
        const themeKeyword = this.themeKeywordInput.value.trim();
        const planningText = this.planningTextInput.value.trim();

        if (!themeKeyword || !planningText) {
            alert('ì£¼ì œì–´ì™€ ê¸°íšì„œ í…ìŠ¤íŠ¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        try {
            const seasons = this.parsePlanningText(planningText);
            const pushMessages = this.generatePushMessagesForSeasons(seasons, themeKeyword);
            this.currentPushMessages = pushMessages; // CSV ìƒì„±ì„ ìœ„í•´ ë°ì´í„° ì €ì¥
            this.displayResults(pushMessages);
            this.resultSection.style.display = 'block';
        } catch (error) {
            alert('ê¸°íšì„œ í…ìŠ¤íŠ¸ íŒŒì‹± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í…ìŠ¤íŠ¸ í˜•ì‹ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            console.error('Parsing error:', error);
        }
    }

    parsePlanningText(text) {
        const lines = text.split('\n').filter(line => line.trim());
        const seasons = [];
        let seasonCount = 1; // 1íšŒì°¨ë¶€í„° ì‹œì‘

        for (const line of lines) {
            // ì‹œì¦Œ ë²ˆí˜¸ê°€ ìˆëŠ” ë¼ì¸ ì°¾ê¸° (ìˆ«ìë¡œ ì‹œì‘í•˜ëŠ” ë¼ì¸)
            const seasonMatch = line.match(/^\s*(\d+)\s+/);
            if (seasonMatch) {
                // ëª¨ë“  ì»¬ëŸ¼ì„ ë¶„ë¦¬ (ë¹ˆ ì»¬ëŸ¼ í¬í•¨)
                const allColumns = line.split('\t');
                
                // ë‚ ì§œ+ì‹œê°„ í˜•ì‹ê³¼ ë‚ ì§œë§Œ ìˆëŠ” í˜•ì‹ ëª¨ë‘ ì²˜ë¦¬
                const dateTimePattern = /^\d{1,2}\/\d{1,2}\s+\d{1,2}:\d{2}$/;
                const dateOnlyPattern = /^\d{1,2}\/\d{1,2}$/;
                
                const dateColumns = allColumns.filter(col => {
                    const trimmed = col.trim();
                    return dateTimePattern.test(trimmed) || dateOnlyPattern.test(trimmed);
                });
                
                if (dateColumns.length >= 4) {
                    let eventStartDate, eventEndDate, rewardStartDate, rewardEndDate;
                    
                    // ì²« ë²ˆì§¸ ì»¬ëŸ¼ì´ ë‚ ì§œ+ì‹œê°„ í˜•ì‹ì¸ì§€ í™•ì¸
                    if (dateTimePattern.test(dateColumns[0])) {
                        // í”¼í¬íƒ€ì„ ìˆëŠ” ê²½ìš°: "5/29 18:00" í˜•ì‹
                        eventStartDate = dateColumns[0].split(' ')[0]; // "5/29" ë¶€ë¶„ë§Œ ì¶”ì¶œ
                        eventEndDate = dateColumns[1].split(' ')[0];   // "6/2" ë¶€ë¶„ë§Œ ì¶”ì¶œ
                        rewardStartDate = dateColumns[2].split(' ')[0]; // "6/2" ë¶€ë¶„ë§Œ ì¶”ì¶œ
                        rewardEndDate = dateColumns[3].split(' ')[0];   // "6/4" ë¶€ë¶„ë§Œ ì¶”ì¶œ
                    } else {
                        // í”¼í¬íƒ€ì„ ì—†ëŠ” ê²½ìš°: "8/28" í˜•ì‹
                        eventStartDate = dateColumns[0];
                        eventEndDate = dateColumns[1];
                        rewardStartDate = dateColumns[2];
                        rewardEndDate = dateColumns[3];
                    }
                    
                    // ìš´ì˜ ê¸°ê°„ ê³„ì‚° (ì´ë²¤íŠ¸ ì‹œì‘ì¼ë¶€í„° ì´ë²¤íŠ¸ ì¢…ë£Œì¼ê¹Œì§€)
                    const eventStart = this.parseSimpleDate(eventStartDate);
                    const eventEnd = this.parseSimpleDate(eventEndDate);
                    const daysDiff = Math.ceil((eventEnd - eventStart) / (1000 * 60 * 60 * 24)) + 1;
                    
                    const season = {
                        number: seasonCount, // 1íšŒì°¨, 2íšŒì°¨...
                        eventStartDate: `${eventStartDate} 18:00`, // ëª©ìš”ì¼ ì˜¤í›„ 6ì‹œ
                        rewardStartDate: `${rewardStartDate} 10:00`, // ì›”ìš”ì¼ ì˜¤ì „ 10ì‹œ
                        eventStartTime: '18:00',
                        rewardStartTime: '10:00',
                        duration: daysDiff,
                        hasPeakTime: daysDiff >= 5 // 5ì¼ ì´ìƒì´ë©´ í”¼í¬íƒ€ì„ ìˆìŒ
                    };
                    seasons.push(season);
                    seasonCount++;
                }
            }
        }

        return seasons;
    }

    generatePushMessagesForSeasons(seasons, themeKeyword) {
        const pushMessages = [];

        seasons.forEach(season => {
            const seasonNumber = season.number;
            const eventStartDate = season.eventStartDate;
            const rewardStartDate = season.rewardStartDate;
            
            // ì‹œì¦Œ ê¸°ê°„ ê³„ì‚° (ì˜ˆ: 5/29~6/02)
            const dateRange = `${eventStartDate}~${rewardStartDate}`;
            
            // ê° ì‹œì¦Œë³„ í‘¸ì‹œ ë©”ì‹œì§€ ìƒì„±
            const messages = this.generateMessagesForSeason(season, themeKeyword);
            
            messages.forEach(msg => {
                pushMessages.push({
                    season: `${seasonNumber}íšŒì°¨\n${dateRange}`,
                    date: msg.date,
                    sendTime: msg.sendTime,
                    target: msg.target,
                    title: msg.title,
                    content: msg.content,
                    data: msg.data
                });
            });
        });

        return pushMessages;
    }

    generateMessagesForSeason(season, themeKeyword) {
        const messages = [];
        const eventStartDate = this.parseDate(season.eventStartDate);
        const rewardStartDate = this.parseDate(season.rewardStartDate);
        
        // ëª©ìš”ì¼ (ì‹œì¦Œ ì‹œì‘)
        const thursday = new Date(eventStartDate);
        messages.push({
            date: this.formatDate(thursday),
            sendTime: 'ëª©ìš”ì¼ ì˜¤í›„ 6ì‹œ',
            target: 'ì „ì²´',
            title: `(ê´‘ê³ )${themeKeyword} ì‹œì¦Œë ˆì´ìŠ¤ ê°œë§‰! ğŸ”¥`,
            content: `ìµœëŒ€ 5ì–µëƒ¥ì— ë„ì „í•´ ë³´ì„¸ìš”! ğŸ(ìˆ˜ì‹ ê±°ë¶€:ê²Œì„ë‚´ì„¤ì •)`,
            data: ''
        });

        // ìˆœìœ„í•˜ë½ ë©”ì‹œì§€ (ìš´ì˜ ê¸°ê°„ì— ë”°ë¼ ë‹¤ë¦„)
        const friday = new Date(thursday);
        friday.setDate(thursday.getDate() + 1);
        const saturday = new Date(thursday);
        saturday.setDate(thursday.getDate() + 2);
        const sunday = new Date(thursday);
        sunday.setDate(thursday.getDate() + 3);

        if (season.hasPeakTime) {
            // 5ì¼ ì´ìƒ: ê¸ˆ,í† ,ì¼
            messages.push({
                date: `${this.formatDate(friday)}~${this.formatDate(sunday)}`,
                sendTime: 'ê¸ˆ,í† ,ì¼ ì˜¤í›„ 1ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: '(ê´‘ê³ )ì´ëŸ°! ìˆœìœ„ê°€ ë–¨ì–´ì¡Œì–´ìš”!ğŸ˜±',
                content: 'ì ‘ì†í•´ì„œ ìˆœìœ„ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”!ğŸ™(ìˆ˜ì‹ ê±°ë¶€:ê²Œì„ë‚´ì„¤ì •)',
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ ìˆœìœ„í•˜ë½ 13ì‹œ(Mnmg_Seasonrace_1)\në‰´ë§ê³ K : ì‹œì¦Œë ˆì´ìŠ¤ ìˆœìœ„í•˜ë½(Mnmgk_Seasonrace_1)`
            });

            messages.push({
                date: `${this.formatDate(friday)}~${this.formatDate(sunday)}`,
                sendTime: 'ê¸ˆ,í† ,ì¼ ì˜¤í›„ 7ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: '(ê´‘ê³ )ì´ëŸ°! ìˆœìœ„ê°€ ë–¨ì–´ì¡Œì–´ìš”!ğŸ˜±',
                content: 'ì•„ì§ ëŠ¦ì§€ ì•Šì•˜ì–´ìš”! ìˆœìœ„ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”!ğŸ™(ìˆ˜ì‹ ê±°ë¶€:ê²Œì„ë‚´ì„¤ì •)',
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ ìˆœìœ„í•˜ë½ 19ì‹œ(Mnmg_Seasonrace_2)\në‰´ë§ê³ K : ì‹œì¦Œë ˆì´ìŠ¤ ìˆœìœ„í•˜ë½ 19ì‹œ(Mnmgk_Seasonrace_2)`
            });
        } else {
            // 3ì¼ ë‹¨ì¶•ìš´ì˜: ê¸ˆ,í† ë§Œ
            messages.push({
                date: `${this.formatDate(friday)}~${this.formatDate(saturday)}`,
                sendTime: 'ê¸ˆ,í†  ì˜¤í›„ 1ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: '(ê´‘ê³ )ì´ëŸ°! ìˆœìœ„ê°€ ë–¨ì–´ì¡Œì–´ìš”!ğŸ˜±',
                content: 'ì ‘ì†í•´ì„œ ìˆœìœ„ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”!ğŸ™(ìˆ˜ì‹ ê±°ë¶€:ê²Œì„ë‚´ì„¤ì •)',
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ ìˆœìœ„í•˜ë½ 13ì‹œ(Mnmg_Seasonrace_1)\në‰´ë§ê³ K : ì‹œì¦Œë ˆì´ìŠ¤ ìˆœìœ„í•˜ë½(Mnmgk_Seasonrace_1)`
            });

            messages.push({
                date: `${this.formatDate(friday)}~${this.formatDate(saturday)}`,
                sendTime: 'ê¸ˆ,í†  ì˜¤í›„ 7ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: '(ê´‘ê³ )ì´ëŸ°! ìˆœìœ„ê°€ ë–¨ì–´ì¡Œì–´ìš”!ğŸ˜±',
                content: 'ì•„ì§ ëŠ¦ì§€ ì•Šì•˜ì–´ìš”! ìˆœìœ„ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”!ğŸ™(ìˆ˜ì‹ ê±°ë¶€:ê²Œì„ë‚´ì„¤ì •)',
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ ìˆœìœ„í•˜ë½ 19ì‹œ(Mnmg_Seasonrace_2)\në‰´ë§ê³ K : ì‹œì¦Œë ˆì´ìŠ¤ ìˆœìœ„í•˜ë½ 19ì‹œ(Mnmgk_Seasonrace_2)`
            });
        }

        // í”¼í¬íƒ€ì„ (ìš´ì˜ ê¸°ê°„ì— ë”°ë¼ ë‹¤ë¦„)
        if (season.hasPeakTime) {
            // 5ì¼ ì´ìƒ: í† ,ì¼ ì˜¤í›„ 8ì‹œ
            messages.push({
                date: `${this.formatDate(saturday)}~${this.formatDate(sunday)}`,
                sendTime: 'í† , ì¼ ì˜¤í›„ 8ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: `(ê´‘ê³ )${themeKeyword} ë ˆì´ìŠ¤ í”¼í¬íƒ€ì„!ğŸ•—`,
                content: 'í”Œë ˆì´ ì‹œ ë³´ìƒ ë‘ë°°! ìˆœìœ„ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”!!ğŸš€(ìˆ˜ì‹ ê±°ë¶€:ê²Œì„ë‚´ì„¤ì •)',
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ í”¼í¬íƒ€ì„(Mnmg_Seasonrace_peaktime)\në‰´ë§ê³ k : ì‹œì¦Œë ˆì´ìŠ¤ í”¼í¬íƒ€ì„(Mnmgk_Seasonrace_peaktime)`
            });
        } else {
            // 3ì¼ ë‹¨ì¶•ìš´ì˜: ê¸ˆìš”ì¼ ì˜¤í›„ 8ì‹œ
            messages.push({
                date: this.formatDate(friday),
                sendTime: 'ê¸ˆ ì˜¤í›„ 8ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: `(ê´‘ê³ )${themeKeyword} ë ˆì´ìŠ¤ í”¼í¬íƒ€ì„!ğŸ•—`,
                content: 'í”Œë ˆì´ ì‹œ ë³´ìƒ ë‘ë°°! ìˆœìœ„ë¥¼ ì˜¬ë ¤ë³´ì„¸ìš”!!ğŸš€(ìˆ˜ì‹ ê±°ë¶€:ê²Œì„ë‚´ì„¤ì •)',
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ í”¼í¬íƒ€ì„(Mnmg_Seasonrace_peaktime)\në‰´ë§ê³ k : ì‹œì¦Œë ˆì´ìŠ¤ í”¼í¬íƒ€ì„(Mnmgk_Seasonrace_peaktime)`
            });
        }

        // ë§ˆê° ì„ë°• ë° ì‹œì¦Œ ì¢…ë£Œ (ìš´ì˜ ê¸°ê°„ì— ë”°ë¼ ë‹¤ë¦„)
        if (season.hasPeakTime) {
            // 5ì¼ ì´ìƒ: ì¼ìš”ì¼ ë§ˆê° ì„ë°• + ì›”ìš”ì¼ ì‹œì¦Œ ì¢…ë£Œ
            messages.push({
                date: this.formatDate(sunday),
                sendTime: 'ì¼ ì˜¤í›„ 6ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: `(ê´‘ê³ )${themeKeyword} ë ˆì´ìŠ¤ ë§ˆê°ë©ë‹ˆë‹¤!â³`,
                content: `ì§€ê¸ˆ ${themeKeyword} ë ˆì´ìŠ¤ì— ì°¸ê°€í•´ë³´ì„¸ìš”!ğŸ‘(ìˆ˜ì‹ ê±°ë¶€: ê²Œì„ë‚´ì„¤ì •)`,
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ ì°¸ì—¬ë…ë ¤(Mnmg_Seasonrace_encourage)\në‰´ë§ê³ k : ì‹œì¦Œë ˆì´ìŠ¤ ì°¸ì—¬ë…ë ¤(Mnmgk_Seasonrace_encourage)`
            });

            const monday = new Date(thursday);
            monday.setDate(thursday.getDate() + 4);
            messages.push({
                date: this.formatDate(monday),
                sendTime: 'ì›”ìš”ì¼ ì˜¤í›„ 5ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: `(ê´‘ê³ )${themeKeyword} ë ˆì´ìŠ¤ ì¢…ë£Œ!!ğŸ`,
                content: 'ì ‘ì†í•˜ì—¬ ìˆœìœ„ì™€ ë³´ìƒì„ í™•ì¸í•´ë³´ì„¸ìš”!!ğŸ†(ìˆ˜ì‹ ê±°ë¶€: ê²Œì„ë‚´ì„¤ì •)',
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ ê²°ê³¼ë°œí‘œ(Mnmg_Seasonrace_result)\në‰´ë§ê³ K : ì‹œì¦Œë ˆì´ìŠ¤ ê²°ê³¼ë°œí‘œ(Mnmgk_Seasonrace_result)`
            });
        } else {
            // 3ì¼ ë‹¨ì¶•ìš´ì˜: ì¼ìš”ì¼ ì‹œì¦Œ ì¢…ë£Œë§Œ
            messages.push({
                date: this.formatDate(sunday),
                sendTime: 'ì¼ìš”ì¼ ì˜¤í›„ 5ì‹œ',
                target: 'ì •ë³´ë¶„ì„ëŒ€ìƒì',
                title: `(ê´‘ê³ )${themeKeyword} ë ˆì´ìŠ¤ ì¢…ë£Œ!!ğŸ`,
                content: 'ì ‘ì†í•˜ì—¬ ìˆœìœ„ì™€ ë³´ìƒì„ í™•ì¸í•´ë³´ì„¸ìš”!!ğŸ†(ìˆ˜ì‹ ê±°ë¶€: ê²Œì„ë‚´ì„¤ì •)',
                data: `ë‰´ë§ê³  : ì‹œì¦Œë ˆì´ìŠ¤ ê²°ê³¼ë°œí‘œ(Mnmg_Seasonrace_result)\në‰´ë§ê³ K : ì‹œì¦Œë ˆì´ìŠ¤ ê²°ê³¼ë°œí‘œ(Mnmgk_Seasonrace_result)`
            });
        }

        return messages;
    }

    parseDate(dateStr) {
        // "5/29 18:00" í˜•ì‹ì„ Date ê°ì²´ë¡œ ë³€í™˜
        const datePart = dateStr.split(' ')[0]; // "5/29" ë¶€ë¶„ë§Œ ì¶”ì¶œ
        const [month, day] = datePart.split('/').map(Number);
        const year = new Date().getFullYear();
        return new Date(year, month - 1, day);
    }

    parseSimpleDate(dateStr) {
        // "8/28" í˜•ì‹ì„ Date ê°ì²´ë¡œ ë³€í™˜
        const [month, day] = dateStr.split('/').map(Number);
        const year = new Date().getFullYear();
        return new Date(year, month - 1, day);
    }

    isValidDate(dateStr) {
        // "8/28" í˜•ì‹ì˜ ë‚ ì§œê°€ ìœ íš¨í•œì§€ ê²€ì¦
        const datePattern = /^\d{1,2}\/\d{1,2}$/;
        if (!datePattern.test(dateStr)) return false;
        
        const [month, day] = dateStr.split('/').map(Number);
        if (month < 1 || month > 12 || day < 1 || day > 31) return false;
        
        return true;
    }

    formatDate(date) {
        return `${date.getMonth() + 1}/${date.getDate()}`;
    }

    displayResults(pushMessages) {
        let html = '<table class="result-table">';
        html += '<thead><tr>';
        html += '<th>ì°¨ìˆ˜</th>';
        html += '<th>ì¼ì</th>';
        html += '<th>ë°œì†¡ì¼</th>';
        html += '<th>ëŒ€ìƒ</th>';
        html += '<th>ì œëª©</th>';
        html += '<th>ë‚´ìš©</th>';
        html += '<th>ë°ì´í„°</th>';
        html += '</tr></thead><tbody>';

        // ì‹œì¦Œë³„ë¡œ ê·¸ë£¹í™”
        const seasonGroups = {};
        pushMessages.forEach(msg => {
            if (!seasonGroups[msg.season]) {
                seasonGroups[msg.season] = [];
            }
            seasonGroups[msg.season].push(msg);
        });

        // ê° ì‹œì¦Œë³„ë¡œ í…Œì´ë¸” í–‰ ìƒì„±
        Object.keys(seasonGroups).forEach(seasonKey => {
            const messages = seasonGroups[seasonKey];
            const rowspan = messages.length;
            
            messages.forEach((msg, index) => {
                html += '<tr>';
                if (index === 0) {
                    // ì²« ë²ˆì§¸ í–‰ì—ë§Œ ì°¨ìˆ˜ í‘œì‹œ (rowspan ì ìš©)
                    html += `<td rowspan="${rowspan}">${msg.season}</td>`;
                }
                html += `<td>${msg.date}</td>`;
                html += `<td>${msg.sendTime}</td>`;
                html += `<td>${msg.target}</td>`;
                html += `<td>${msg.title}</td>`;
                html += `<td>${msg.content}</td>`;
                html += `<td>${msg.data}</td>`;
                html += '</tr>';
            });
        });

        html += '</tbody></table>';
        this.resultTableContainer.innerHTML = html;
    }

    clearForm() {
        this.themeKeywordInput.value = '';
        this.planningTextInput.value = '';
        this.resultSection.style.display = 'none';
    }

    copyToClipboard() {
        const table = this.resultTableContainer.querySelector('table');
        if (!table) return;

        const csvContent = this.convertTableToCSV(table);
        navigator.clipboard.writeText(csvContent).then(() => {
            alert('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ í˜•ì‹ìœ¼ë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }).catch(err => {
            console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
            alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        });
    }

    downloadCSV() {
        const table = this.resultTableContainer.querySelector('table');
        if (!table) return;

        const csvContent = this.convertTableToCSV(table);
        const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.setAttribute('href', url);
        link.setAttribute('download', `ì‹œì¦Œë ˆì´ìŠ¤_í‘¸ì‹œë©”ì‹œì§€_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    convertTableToCSV(table) {
        // ì›ë³¸ ë°ì´í„°ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ CSV ìƒì„±
        const pushMessages = this.currentPushMessages; // í˜„ì¬ ìƒì„±ëœ ë©”ì‹œì§€ ë°ì´í„° ì €ì¥
        if (!pushMessages) return '';
        
        let csv = [];
        
        // í—¤ë” ì¶”ê°€
        csv.push('"ì°¨ìˆ˜","ì¼ì","ë°œì†¡ì¼","ëŒ€ìƒ","ì œëª©","ë‚´ìš©","ë°ì´í„°"');
        
        // ê° ë©”ì‹œì§€ë¥¼ CSV í–‰ìœ¼ë¡œ ë³€í™˜
        pushMessages.forEach(msg => {
            const row = [
                `"${msg.season}"`,
                `"${msg.date}"`,
                `"${msg.sendTime}"`,
                `"${msg.target}"`,
                `"${msg.title}"`,
                `"${msg.content}"`,
                `"${msg.data}"`
            ];
            csv.push(row.join(','));
        });
        
        return csv.join('\n');
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', () => {
    new SeasonRacePushGenerator();
});
    </script>
</body>
</html> 